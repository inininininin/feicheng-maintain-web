<!DOCTYPE html>
<html>

<head>

    <title>飞橙-运维-配置管理</title>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon" />
    <script src="https://lib.sinaapp.com/js/jquery/1.9.0/jquery.min.js"></script>
    <script src="./zTree_v3/js/jquery.ztree.all.js"></script>
    <link rel="stylesheet" href="./zTree_v3/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="./jquery-easyui-1.8.7/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="./jquery-easyui-1.8.7/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="./jquery-easyui-1.8.7/demo/demo.css">
    <script type="text/javascript" src="./jquery-easyui-1.8.7/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="./jquery-easyui-1.8.7/locale/easyui-lang-zh_CN.js"></script>
    <link rel="stylesheet" href="./jQueryViewer20160329/css/viewer.min.css">
    <script src="./jQueryViewer20160329/js/viewer.min.js"></script>
    <script src="./jQueryViewer20160329/js/viewer-jquery.min.js"></script>
    <link rel="stylesheet" href="./kindeditor/themes/default/default.css" />
    <link rel="stylesheet" href="./kindeditor/plugins/code/prettify.css" />
    <script charset="utf-8" src="./kindeditor/kindeditor-all.js"></script>
    <script charset="utf-8" src="./kindeditor/lang/zh-CN.js"></script>
    <script charset="utf-8" src="./kindeditor/plugins/code/prettify.js"></script>
    <script src="./js/moment.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/jquery.oneall.js"></script>
</head>

<style>
img {
        object-fit:contain;
    }
</style>

<script>



    var queryStringObject = common.queryStringObject();
    var config = {},userProtocolKindEditor

    
   





    $.parser.onComplete = function () {
        debugger
    }


    $(document).ready(function(){
        debugger
        userProtocolKindEditor = KindEditor.create('#userProtocol', {
               
               cssPath: './kindeditor/plugins/code/prettify.css',
               uploadJson: '/kindeditor/upload_json.jsp',
               fileManagerJson: '/kindeditor/file_manager_json.jsp',
               allowFileManager: true,
               afterCreate: function () {
                   var self = this;
                   KindEditor.ctrl(document, 13, function () {
                       self.sync();
                       document.forms['example'].submit();
                   });
                   KindEditor.ctrl(self.edit.doc, 13, function () {
                       self.sync();
                       document.forms['example'].submit();
                   });

                   debugger
                   if (config.userProtocol)
                       $.get(`${config.userProtocol}`, function (data) {
                           self.html(data)
                       })
               }
           })

        $("#loading").remove();
        
    })

function updateConfirm(){
    debugger
    $.messager.confirm('提示','确认修改吗?',function(r){
        if(r){
         
            $.ajax({
                type: 'post',
                contentType:"text/plain",
                url: '/upload-stream?'+$.param({'originalUrl':config.userProtocol,ext:'html'}),
                async:false,
                data: userProtocolKindEditor.html(),
                success: function (res) {
                    debugger
                    if (res.codeMsg)
                        $.messager.alert('提示',res.codeMsg)
                    if (res.code == 0) {
                        config.userProtocol=res.data.url
                    } 
                }
            })

            $.ajax({
                            type: 'post',
                            url: '/maintain/config/update-config',
                            data: config,
                            success: function (res) {
                                debugger
                                if (res.codeMsg)
                                    $.messager.alert('提示',res.codeMsg);
                                if (res.code == 0) {
                                    if (!res.codeMsg)
                                          $.messager.alert('提示','操作成功',null,function(){ location.reload()});
                                } 
                            }
                        })
        }
      
    })
    
}
        




</script>

<body style="margin:0;padding:0;">
    <div id="loading" class='' style="position: absolute; z-index: 1000; top: 0px; left: 0px; 
    width: 100%; height: 100%; background: white; text-align: center;padding:5px 10px">
        <font>loading···</font>
    </div>
    <script>
         $.ajax({
        type: 'get',
        url: `/maintain/config/config`,
        async: false,
        success: function (res) {
            debugger
            if (res.codeMsg)
                $.messager.alert('提示',res.codeMsg);
            if (res.code == 0) {
                config = res.data;
            }
        }
    })
    </script>
        <table id="datagrid"  data-options="singleSelect:true,height:'700px'">
            <thead>
                <tr>
                    <th data-options="field:'name',width:200,align:'right'">属性&nbsp;</th>
                    <th data-options="field:'value',width:500">值</th>
                </tr>
            </thead>
            <tbody>
              
                <tr>
                    <td>项目名&nbsp;</td>
                    <td><input id="projectName" class="easyui-textbox" style="width:100%" data-options="
                        value:config.projectName,
                        iconWidth:20,
                        icons:[{
                            iconCls:'icon-clear',
                            handler: function(e){
                                debugger
                                $(e.data.target).textbox('setValue','');
                            }
                        }],
                        onChange:function(newValue, oldValue){
                            config.projectName=newValue
                        }" style="width:200px"></td>
                </tr>
                <tr>
                    <td>项目Logo&nbsp;</td>
                    <td>
                        <div id="projectLogo">
                            <img style="display:none;" src="./image/image-error.png" onload="$('#projectLogo-value').attr('src',config.projectLogo).parent().viewer({url: 'src',});if(config.projectLogo) $('#projectLogo-value').show();" />
                            <img id="projectLogo-value" style="width:30px;height:30px;object-fit:contain;cursor:pointer;vertical-align: baseline;display:none;" onerror='debugger;$(this).attr("src","./image/image-error.png");' />
                            <input type="file" style="display:none;" onchange="
                                javascript:
                                var target = this;
                                if(this.files.length>0){
                                    var file = this.files[0];
                                    var fd = new FormData()
                                    fd.append('file', file);
                                    $.ajax({
                                        url: '/upload-file?' + $.param({ quality: 0.8 }),
                                        type: 'POST',
                                        data: fd,
                                        cache: false,
                                        processData: false,
                                        contentType: false,
                                        async: true,
                                        success: function (res) {
                                            if (res.codeMsg)
                                                $.messager.alert('提示',res.codeMsg)
                                            if (res.code == 0) {
                                                config.projectLogo=res.data.url 
                                                $(target).prev().attr('src',config.projectLogo).show()
                                             target.value=null
                                            }
                                        }
                                    })
                                }
                            " />
                            <a title="删除" href="JavaScript:void(0)" class="easyui-linkbutton" iconCls="icon-clear" plain="true"
                                style="vertical-align: text-bottom;"
                                onclick="$(this).prev().prev().attr('src',null).hide();config.projectLogo='';"></a>

                            <a title="选择" href="JavaScript:void(0)" class="easyui-linkbutton" iconCls="icon-choose" plain="true"
                                style="vertical-align: text-bottom;" onclick="$(this).prev().prev().click()"></a>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>公司名&nbsp;</td>
                    <td><input id="servantName" class="easyui-textbox" style="width:100%" data-options="
                        value:config.servantName,
                        iconWidth:20,
                        icons:[{
                            iconCls:'icon-clear',
                            handler: function(e){
                                debugger
                                $(e.data.target).textbox('setValue','');
                            }
                        }],
                        onChange:function(newValue, oldValue){
                            config.servantName=newValue
                        }" style="width:200px"></td>
                </tr>
                <tr>
                    <td>公司全名&nbsp;</td>
                    <td><input id="servantFullName" class="easyui-textbox" style="width:100%" data-options="
                        value:config.servantFullName,
                        iconWidth:20,
                        icons:[{
                            iconCls:'icon-clear',
                            handler: function(e){
                                debugger
                                $(e.data.target).textbox('setValue','');
                            }
                        }],
                        onChange:function(newValue, oldValue){
                            config.servantFullName=newValue
                        }" style="width:200px"></td>
                </tr>
                <tr>
                    <td>公司Logo&nbsp;</td>
                    <td>
                        <div id="servantLogo">
                            <img style="display:none;" src="./image/image-error.png" onload="$('#servantLogo-value').attr('src',config.servantLogo).parent().viewer({url: 'src',});if(config.servantLogo) $('#servantLogo-value').show();" />
                            <img id="servantLogo-value" style="width:30px;height:30px;object-fit:contain;cursor:pointer;vertical-align: baseline;display:none;" onerror='debugger;$(this).attr("src","./image/image-error.png");' />
                            <input type="file" style="display:none;" onchange="
                                javascript:
                                var target = this;
                                if(this.files.length>0){
                                    var file = this.files[0];
                                    var fd = new FormData()
                                    fd.append('file', file);
                                    $.ajax({
                                        url: '/upload-file?' + $.param({ quality: 0.8 }),
                                        type: 'POST',
                                        data: fd,
                                        cache: false,
                                        processData: false,
                                        contentType: false,
                                        async: true,
                                        success: function (res) {
                                            if (res.codeMsg)
                                                $.messager.alert('提示',res.codeMsg)
                                            if (res.code == 0) {
                                                config.servantLogo=res.data.url 
                                                $(target).prev().attr('src',config.servantLogo).show()
                                             target.value=null
                                            }
                                        }
                                    })
                                }
                            " />
                            <a title="删除" href="JavaScript:void(0)" class="easyui-linkbutton" iconCls="icon-clear" plain="true"
                                style="vertical-align: text-bottom;"
                                onclick="$(this).prev().prev().attr('src',null).hide();config.servantLogo='';"></a>

                            <a title="选择" href="JavaScript:void(0)" class="easyui-linkbutton" iconCls="icon-choose" plain="true"
                                style="vertical-align: text-bottom;" onclick="$(this).prev().prev().click()"></a>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>公司封面&nbsp;</td>
                    <td>
                        <div id="servantCover">
                            <img style="display:none;" src="./image/image-error.png" onload="$('#servantCover-value').attr('src',config.servantCover).parent().viewer({url: 'src',});if(config.servantCover) $('#servantCover-value').show();" />
                            <img id="servantCover-value" style="width:30px;height:30px;object-fit:contain;cursor:pointer;vertical-align: baseline;display:none;" onerror='debugger;$(this).attr("src","./image/image-error.png");' />
                            <input type="file" style="display:none;" onchange="
                                javascript:
                                var target = this;
                                if(this.files.length>0){
                                    var file = this.files[0];
                                    var fd = new FormData()
                                    fd.append('file', file);
                                    $.ajax({
                                        url: '/upload-file?' + $.param({ quality: 0.8 }),
                                        type: 'POST',
                                        data: fd,
                                        cache: false,
                                        processData: false,
                                        contentType: false,
                                        async: true,
                                        success: function (res) {
                                            if (res.codeMsg)
                                                $.messager.alert('提示',res.codeMsg)
                                            if (res.code == 0) {
                                                config.servantCover=res.data.url 
                                                $(target).prev().attr('src',config.servantCover).show()
                                             target.value=null
                                            }
                                        }
                                    })
                                }
                            " />
                            <a title="删除" href="JavaScript:void(0)" class="easyui-linkbutton" iconCls="icon-clear" plain="true"
                                style="vertical-align: text-bottom;"
                                onclick="$(this).prev().prev().attr('src',null).hide();config.servantCover='';"></a>

                            <a title="选择" href="JavaScript:void(0)" class="easyui-linkbutton" iconCls="icon-choose" plain="true"
                                style="vertical-align: text-bottom;" onclick="$(this).prev().prev().click()"></a>
                        </div>
                    </td>
                </tr>
                
                <tr>
                    <td>地址&nbsp;</td>
                    <td><input id="servantAddress" class="easyui-textbox" style="width:100%" data-options="
                        value:config.servantAddress,
                        iconWidth:20,
                        icons:[{
                            iconCls:'icon-clear',
                            handler: function(e){
                                debugger
                                $(e.data.target).textbox('setValue','');
                            }
                        }],
                        onChange:function(newValue, oldValue){
                            config.servantAddress=newValue
                        }" style="width:200px"></td>
                </tr>
                <tr>
                    <td>坐标&nbsp;</td>
                    <td><input id="servantGpsCoordinate" class="easyui-textbox" style="width:100%" data-options="
                        value:config.servantGpsCoordinate,
                        iconWidth:20,
                        icons:[{
                            iconCls:'icon-clear',
                            handler: function(e){
                                debugger
                                $(e.data.target).textbox('setValue','');
                            }
                        }],
                        onChange:function(newValue, oldValue){
                            config.servantGpsCoordinate=newValue
                        }" style="width:200px"></td>
                </tr>
                <tr>
                    <td>股票代码&nbsp;</td>
                    <td><input id="servantStockcode" class="easyui-textbox" style="width:100%" data-options="
                        value:config.servantStockcode,
                        iconWidth:20,
                        icons:[{
                            iconCls:'icon-clear',
                            handler: function(e){
                                debugger
                                $(e.data.target).textbox('setValue','');
                            }
                        }],
                        onChange:function(newValue, oldValue){
                            config.servantStockcode=newValue
                        }" style="width:200px"></td>
                </tr>
                <tr>
                    <td>icp&nbsp;</td>
                    <td><input id="icp" class="easyui-textbox" style="width:100%" data-options="
                        value:config.icp,
                        iconWidth:20,
                        icons:[{
                            iconCls:'icon-clear',
                            handler: function(e){
                                debugger
                                $(e.data.target).textbox('setValue','');
                            }
                        }],
                        onChange:function(newValue, oldValue){
                            config.icp=newValue
                        }" style="width:200px"></td>
                </tr>
                <tr>
                    <td>电话&nbsp;</td>
                    <td><input id="servantTel" class="easyui-textbox" style="width:100%" data-options="
                        value:config.servantTel,
                        iconWidth:20,
                        icons:[{
                            iconCls:'icon-clear',
                            handler: function(e){
                                debugger
                                $(e.data.target).textbox('setValue','');
                            }
                        }],
                        onChange:function(newValue, oldValue){
                            config.servantTel=newValue
                        }" style="width:200px"></td>
                </tr>
                <tr>
                    <td>Email&nbsp;</td>
                    <td><input id="servantEmail" class="easyui-textbox" style="width:100%" data-options="
                        value:config.servantEmail,
                        iconWidth:20,
                        icons:[{
                            iconCls:'icon-clear',
                            handler: function(e){
                                debugger
                                $(e.data.target).textbox('setValue','');
                            }
                        }],
                        onChange:function(newValue, oldValue){
                            config.servantEmail=newValue
                        }" style="width:200px"></td>
                </tr>
                <tr>
                    <td>QQ&nbsp;</td>
                    <td><input id="servantQQ" class="easyui-textbox" style="width:100%" data-options="
                        value:config.servantQQ,
                        iconWidth:20,
                        icons:[{
                            iconCls:'icon-clear',
                            handler: function(e){
                                debugger
                                $(e.data.target).textbox('setValue','');
                            }
                        }],
                        onChange:function(newValue, oldValue){
                            config.servantQQ=newValue
                        }" style="width:200px"></td>
                </tr>
                
                <tr>
                    <td>微信二维码&nbsp;</td>
                    <td>
                        <div id="servantWxQrcode">
                            <img style="display:none;" src="./image/image-error.png" onload="$('#servantWxQrcode-value').attr('src',config.servantWxQrcode).parent().viewer({url: 'src',});if(config.servantWxQrcode) $('#servantWxQrcode-value').show();" />
                            <img id="servantWxQrcode-value" style="width:30px;height:30px;object-fit:contain;cursor:pointer;vertical-align: baseline;display:none;" onerror='debugger;$(this).attr("src","./image/image-error.png");' />
                            <input type="file" style="display:none;" onchange="
                                javascript:
                                var target = this;
                                if(this.files.length>0){
                                    var file = this.files[0];
                                    var fd = new FormData()
                                    fd.append('file', file);
                                    $.ajax({
                                        url: '/upload-file?' + $.param({ quality: 0.8 }),
                                        type: 'POST',
                                        data: fd,
                                        cache: false,
                                        processData: false,
                                        contentType: false,
                                        async: true,
                                        success: function (res) {
                                            if (res.codeMsg)
                                                $.messager.alert('提示',res.codeMsg)
                                            if (res.code == 0) {
                                                config.servantWxQrcode=res.data.url 
                                                $(target).prev().attr('src',config.servantWxQrcode).show()
                                             target.value=null
                                            }
                                        }
                                    })
                                }
                            " />
                            <a title="删除" href="JavaScript:void(0)" class="easyui-linkbutton" iconCls="icon-clear" plain="true"
                                style="vertical-align: text-bottom;"
                                onclick="$(this).prev().prev().attr('src',null).hide();config.servantWxQrcode='';"></a>

                            <a title="选择" href="JavaScript:void(0)" class="easyui-linkbutton" iconCls="icon-choose" plain="true"
                                style="vertical-align: text-bottom;" onclick="$(this).prev().prev().click()"></a>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>用户协议&nbsp;</td>
                    <td><textarea id="userProtocol" style="width: 100%;height:500px;padding:1px 4px"></textarea></td>
                </tr>
            </tbody>
        </table>
        

        <div style="margin-left:5px;margin-top:5px;">
            <a id="update" href="JavaScript:void(0)" class="easyui-linkbutton" iconCls="icon-edit"
                onclick="$('#update,#remove,#reload,#updatePasswordPageEntrance').hide();$('#updateConfirm,#updateCancel').show()">修改</a>
            <a id="reload" href="JavaScript:void(0)" class="easyui-linkbutton" iconCls="icon-reload"
                onclick="$.messager.confirm('提示','已编辑的数据将丢失, 确认继续吗?',function(r){if(r) location.reload()})">刷新</a>
            <a id="updateConfirm" href="JavaScript:void(0)" class="easyui-linkbutton" style="display:none;" iconCls="icon-save"
                onclick="updateConfirm()">确认</a>
            <a id="updateCancel" href="JavaScript:void(0)" class="easyui-linkbutton" style="display:none;" iconCls="icon-cancel"
                onclick="$('#update,#remove,#reload,#updatePasswordPageEntrance').show();$('#updateConfirm,#updateCancel').hide()">取消</a>
        </div>

</body>
<script>
        $('#datagrid').datagrid()
</script>

</html>